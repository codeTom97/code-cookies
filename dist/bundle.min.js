"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function n(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var CodeCookies=function(){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"code_cookies",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:7200;_classCallCheck(this,o),this.runtime="; max-age="+t,this.keyName=e}return _createClass(o,[{key:"getCookies",value:function(e){var t=e;if(void 0===t&&(t=this.keyName),0<document.cookie.length){var o=document.cookie.indexOf(t+"=");if(-1!==o){o=o+t.length+1;var n=document.cookie.indexOf(";",o);return-1===n&&(n=document.cookie.length),unescape(document.cookie.substring(o,n))}}return""}},{key:"setCookies",value:function(e,t){for(var o=arguments.length,n=Array(2<o?o-2:0),i=2;i<o;i++)n[i-2]=arguments[i];var r=n,s=this.keyName;if(t)switch(t.constructor){case Number:this.runtime=t===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+t;break;case String:this.runtime="; expires="+t;break;case Date:this.runtime="; expires="+t.toUTCString()}0<r.length&&r[0].CookiesName&&(s=r[0].CookiesName),document.cookie=s+"="+e+this.runtime}},{key:"clearCookies",value:function(e){this.setCookies("",-1,{CookiesName:e})}}]),o}(),CodeStorage=exports.CodeStorage=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"code_storage";_classCallCheck(this,t),this.keyName=e}return _createClass(t,[{key:"getSession",value:function(e,t){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=this.keyName,i=void 0;if(""!==e&&(n=e),i=o?localStorage.getItem(n):sessionStorage.getItem(n),"function"!=typeof t)return i;t&&t(i)}},{key:"setSession",value:function(e,t,o){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=e,r=this.keyName;"object"===(void 0===e?"undefined":_typeof(e))&&(i=JSON.stringify(i)),""!==t&&(r=t),n?localStorage.setItem(r,i):sessionStorage.setItem(r,i),"function"==typeof o&&o&&o()}},{key:"delSession",value:function(e,t){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.keyName;o?localStorage.removeItem(e):sessionStorage.removeItem(e),"function"==typeof t&&t&&t()}},{key:"clearSession",value:function(e){1<arguments.length&&void 0!==arguments[1]&&arguments[1];local?localStorage.clear():sessionStorage.clear(),"function"==typeof e&&e&&e()}}]),t}(),CodeDB=exports.CodeDB=function(){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"code_db",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;_classCallCheck(this,o),this.dbName=e||"code_db",this.version=t,this.isOpenDB=!1,this.opendb,this.idbRequest=""}return _createClass(o,[{key:"openDb",value:function(n){var i=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"id",s=arguments[2];this.isOpenDB?console.warn("数据库已经开启，切勿频繁打开"):(this.opendb||(this.opendb=indexedDB.open(this.dbName,this.version)),this.opendb.onupgradeneeded=function(e){var t=e.target;if(i.isOpenDB=!0,"done"===t.readyState){if(i.idbRequest=t.result,!i.idbRequest.objectStoreNames.contains(n)){var o=i.idbRequest.createObjectStore(n,{keyPath:r});s.forEach(function(e){o.createIndex(e.name,e.name,{unique:e.isUnique})})}console.log("数据库更新成功")}},this.opendb.onsuccess=function(e){var t=e.target;i.isOpenDB=!0,"done"===t.readyState&&(i.idbRequest=t.result,console.log("数据库打开成功"))},this.opendb.onerror=function(){console.error("数据库异常，请刷新浏览器重试")})}},{key:"setStore",value:function(e,t){if(this.version===this.idbRequest.version){var o=this.idbRequest.transaction([e],"readwrite").objectStore(e).add(t);o.onsuccess=function(e){console.log("写入成功")},o.onerror=function(e){if(!e.isTrusted)throw new Error(e);console.error("写入失败: 已经存在数据")}}}},{key:"putStore",value:function(e,t){if(this.version===this.idbRequest.version){var o=this.idbRequest.transaction([e],"readwrite").objectStore(e).put(t);o.onsuccess=function(e){console.log("更新成功")},o.onerror=function(e){if(!e.isTrusted)throw new Error(e);console.error("更新失败: 已经存在数据")}}}},{key:"getStoreItem",value:function(e,t){if(this.version===this.idbRequest.version){var n="",i=this.idbRequest.transaction([e]).objectStore(e).get(t);return new Promise(function(t,o){i.onsuccess=function(e){console.log("读取成功"),n=e.target.result,t(n)},i.onerror=function(e){e.isTrusted?console.error("读取失败: 数据不存在"):o(new Error(e))}})}}},{key:"removeStoreItem",value:function(e,t){if(this.version===this.idbRequest.version){var o=this.idbRequest.transaction([e],"readwrite").objectStore(e).delete(t);return new Promise(function(t,e){o.onsuccess=function(e){t("删除成功")}})}}}]),o}();exports.default=CodeCookies;